---
layout: post
title: Neo4j Guide
tags: [Neo4j, Database, Graph Data]
color: rgb(224, 1, 152)
feature-img: "assets/img/post-cover/12-cover.png"
thumbnail: "assets/img/post-cover/12-cover.png"
author: QubitPi
excerpt_separator: <!--more-->
---

Neo4j is a graph databases specialized for Data Science field.

<!--more-->

* TOC
{:toc}

## Books

* [Graph Algorithms: Examples in Spark and Neo4j]({{ "/assets/pdf/graph-algorithms.pdf" | relative_url}})
* [Intro Graph Data Science]({{ "/assets/pdf/graph-data-science-for-dummies.pdf" | relative_url}})
* [Graph Databases]({{ "/assets/pdf/graph-databases.pdf" | relative_url}})

## Neo4j Query Language - Cypher

Cypher is strongly based on patterns, which are used to match desired graph structures. Once a matching structure has
been found or created, Neo4j can use it for further processing.

## [Naming Conventions](https://neo4j.com/docs/cypher-manual/current/syntax/naming/)

| Node labels        | Camel-case, beginning with an upper-case character | e.g. `:VehicleOwner` rather than `:vehicle_owner` |
| Relationship types | Upper-case, using underscore to separate words     | e.g. `:OWNS_VEHICLE` rather than `:ownsVehicle`   |

### Desktop

#### Create New Project

Next, you will create a new project in Neo4j Desktop. You can only have a single DBMS running, so you must first stop
the DBMS that is started by clicking the `Stop` button:

![Error loading generic-stop-movie-database.png!]({{ "/assets/img/generic-stop-movie-database.png" | relative_url}})

You should now see that there is no active DBMS:

![Error loading generic-movie-database-stopped.png!]({{ "/assets/img/generic-movie-database-stopped.png" | relative_url}})

Add a new project by clicking `New` at the top of the sidebar:

![Error loading generic-create-project.png!]({{ "/assets/img/generic-create-project.png" | relative_url}})

This creates a project named `Project`:

![Error loading generic-project-created.png!]({{ "/assets/img/generic-project-created.png" | relative_url}})

You want your projects to be named something that describes the goal of the project. You can change the name of a
project by hovering over the area to the right of the project name and selecting the `Edit` button:

![Error loading generic-name-project.png!]({{ "/assets/img/generic-name-project.png" | relative_url}})

Then you type a name for the project and hit the "Check" button to save the name.

![Error loading generic-change-project-name.png!]({{ "/assets/img/generic-change-project-name.png" | relative_url}})

Now we see the project with the changed name:

![Error loading generic-project-named.png!]({{ "/assets/img/generic-project-named.png" | relative_url}})

To remove the project, hover over the Project row in the projects menu and click the trash bin icon that appears on the
right side

#### Creating a DBMS

A DBMS is a Neo4j Server instance that contains the `system` and `neo4j` databases, but can contain more databases
(multi-db feature of Neo4j 4.x Enterprise Edition)

In a Neo4j Desktop project, you can create one or more DBMSs. Next, you will create a local DBMS in a project and start
it.

In the project where you want to add the DBMS, click the `Add` button, and then select `Local DBMS`:

![Error loading generic-create-local-dbms.png!]({{ "/assets/img/generic-create-local-dbms.png" | relative_url}})

This opens a dialog where you will specify the details of the DBMS. You can use the default name for the DBMS, which is
Graph DBMS, but you should name it something that helps to identify the use case for the DBMS. Here we specify "MyDBMS"
as the name:

![Error loading generic-name-dbms.png!]({{ "/assets/img/generic-name-dbms.png" | relative_url}})

You _must_ also specify a password for the DBMS so enter a password that you will remember:

![Error loading generic-password-dbms.png!]({{ "/assets/img/generic-password-dbms.png" | relative_url}})

Neo4j Desktop will create a DBMS with the default version for Neo4j Desktop. However, you can select a different
version. Keep in mind that if there is a down arrow shown next to the version, this means that Neo4j Desktop will need
to download resources for that particular version of the DBMS. To do this you need to be connected to the Internet:

![Error loading generic-version-dbms.png!]({{ "/assets/img/generic-version-dbms.png" | relative_url}})

After you have specifed the details for the DBMS you want to create, you click the `Create` button:

![Error loading generic-create-dbms.png!]({{ "/assets/img/generic-create-dbms.png" | relative_url}})

And here is what you should see after the DBMS is successfully created:

![Error loading generic-dbms-created.png!]({{ "/assets/img/generic-dbms-created.png" | relative_url}})

Recall that you cannot have more than one DBMS started. Provided you have no other DBMSs started in Neo4j Desktop, you
can start your newly-created DBMS by hovering to the right of the DBMS name and clicking the `Start` button:

![Error loading generic-start-dbms.png!]({{ "/assets/img/generic-start-dbms.png" | relative_url}})

The DBMS will take some moments to start. After it is started, you should see something like this:

![Error loading generic-dbms-started.png!]({{ "/assets/img/generic-dbms-started.png" | relative_url}})

After the DBMS is started, you can access it with clients running on your system such as Neo4j Browser, Neo4j Bloom,
etc. In Neo4j Desktop, the DBMS is an Enterprise Server, but it can only be accessed locally.

You have now created your own DBMS!

### Creating Data

```
CREATE (:Movie { title:"The Matrix",released:1997 })
```

If case we also want to return the created data we can add a RETURN clause, which refers to the variable we’ve assigned to our pattern elements.

```
CREATE (p:Person { name:"Keanu Reeves", born:1964 })
RETURN p
```

```
CREATE (a:Person { name:"Tom Hanks",
  born:1956 })-[r:ACTED_IN { roles: ["Forrest"]}]->(m:Movie { title:"Forrest Gump",released:1994 })
CREATE (d:Person { name:"Robert Zemeckis", born:1951 })-[:DIRECTED]->(m)
RETURN a,d,r,m
```

This is the part of the graph we just updated:

![Error loading neo4j-example3.png!]({{ "/assets/img/neo4j-example3.png" | relative_url}})

In most cases, we want to connect new data to existing structures. This requires that we know how to find existing
patterns in our graph data, which we will look at next.

### Matching Patterns

To find the data we’ve created so far, we can start looking for all nodes labeled with the `Movie` label.

```
MATCH (m:Movie)
RETURN m
```

Here's the result:

![Error loading neo4j-match-eg.png!]({{ "/assets/img/neo4j-match-eg.png" | relative_url}})

We can also look for a specific person, like _Keanu Reeves_.

```
MATCH (person:Person { name:"Keanu Reeves" })
RETURN person
```

This query returns the matching node:

![Error loading neo4j-match-single-person-eg.png!]({{ "/assets/img/neo4j-match-single-person-eg.png" | relative_url}})

Note that not all properties of a node are required. In most cases you have key-properties like SSN, emails, geolocation
or age to look for.

We can also find more interesting connections, like for instance the movies titles that _Tom Hanks_ acted in and the
roles he played.

```
MATCH (person:Person { name:"Tom Hanks" })-[role:ACTED_IN]->(movie:Movie)
RETURN movie.title, role.roles
```

![Error loading neo4j-connection-example.png!]({{ "/assets/img/neo4j-connection-example.png" | relative_url}})

### Attaching Structures (Adding Nodes/Edges to Graph)

To extend the graph with new information, we
 
1. match the existing graph component, then
2. attach new nodes to them via relationships.

Let's, for example, add _Cloud Atlas_ as a new movie for _Tom Hanks_:

```
MATCH (tomHanks:Person { name: "Tom Hanks" })
CREATE (movie:Movie { title: "Cloud Atlas", released: 2012 })
CREATE (person)-[r:ACTED_IN { roles: ['Zachry']}]->(m)
RETURN p,r,m
```
